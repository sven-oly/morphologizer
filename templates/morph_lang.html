<!doctype html>
<html>
  <head>

    <style>
      p.radio, div.radio {
          text-indent: -15px;
          padding-left: 50px;
      }
    </style>

    <script type="text/javascript">

      // Global language code
      const lang_code = '{{lang_code}}';
      
      function get_morph_data(caller_function, text_source_id, output_id, lang_code) {
          // Gets informatino from the back end and puts results into the output area specified.
          //console.log("get_morph_data" + caller_function + ' ' + text_source + ' ' + output_id);
          const input_source = document.getElementById(text_source_id);
          const input_text = input_source.value;
          const output_element = document.getElementById(output_id);

          let req = new XMLHttpRequest();
          req.onreadystatechange = function() {
              if (this.readyState == 4 && this.status == 200) {
                  alert(this.responseText);
                  const raw_data = this.responseText;
                  // Try to force a newline here.
                  output_element.value = raw_data.replace(",", ",<br />");
                  const x = 2;
              } else {
                  const x = 1;
              }
          };

          let target_list = [];
          target_list.push('function=' + caller_function);
          target_list.push('lang_code=' + lang_code);
          target_list.push('input_text=' + input_text.trim());
          const target = target_list.join('&');
          
/*          req.open('POST', target);
          req.setRequestHeader('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');
          req.send(");
*/
          req.open('POST', '/get_morph_results/', true);
          req.setRequestHeader('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');
          req.send(target);
      }

      function get_generate_data() {
          // Gets informatino from the back end and puts results into the output area specified.
          const input_source = document.getElementById('gen_text');
          const input_text = input_source.value;
          const output_element = document.getElementById('generate_response');

          let req = new XMLHttpRequest();
          req.onreadystatechange = function() {
              if (this.readyState == 4 && this.status == 200) {
                  const raw_data = this.responseText;
                  const result_data = JSON.parse(raw_data);
                  output_element.value = result_data['result_text'];
              }
          };

          let target_list = [];
          target_list.push('function=' + 'generate');
          target_list.push('lang_code=' + lang_code);
          const input_text_ready = encodeURIComponent(input_text.trim());
          target_list.push('input_text=' + input_text_ready);
          const target = target_list.join('&');
          
          req.open('POST', '/get_morph_results/', true);
          req.setRequestHeader('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');
          req.send(target);
      }
      
      function get_parse_data() {
          // Gets informatino from the back end and puts results into the output area specified.
          const input_source = document.getElementById('parse_text');
          const input_text = input_source.value;
          const output_element = document.getElementById('parse_response');

          let req = new XMLHttpRequest();
          req.onreadystatechange = function() {
              if (this.readyState == 4 && this.status == 200) {
                  const raw_data = this.responseText;
                  const result_data = JSON.parse(raw_data);
                  output_element.value = result_data['result_text'];
              }
          };

          let target_list = [];
          target_list.push('function=' + 'parse');
          target_list.push('lang_code=' + lang_code);
          const input_text_ready = encodeURIComponent(input_text.trim());
          target_list.push('input_text=' + input_text_ready);
          const target = target_list.join('&');
          
          req.open('POST', '/get_morph_results/', true);
          req.setRequestHeader('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');
          req.send(target);
      }

      const sample_matcher = /\'([^\']*)\'/g;
      function populate_from_sample(selector) {
          const item_strings = [...selector.value.matchAll(sample_matcher)];

          // Put these values into the input areas.
          // Put these values into the input areas.
          const parse_input = document.getElementById('parse_text');
          parse_input.value = item_strings[0][1];
          
          const gen_input = document.getElementById('gen_text');
          gen_input.value = item_strings[1][1];
      }

      function change_generate_option(selection) {
          
      }

      // Gets all the paramters, eliminating the "None" values, and combining
      function get_generate_parameters() {
          // Surround each with [] and combine with '+'
          // {% for part in gloss_parts.keys() %}
          // something
          // {% endfor %}
      }

    </script>
    
  </head>
  <body>
    <h1>Morphy - main</h1>
    <p>A morphological generator and parser for {{lang_name}} ({{lang_code}}).
    <!-- Input box -->
      <h2>Generator</h2>
      <div id='gloss' padding-left=3>
        {% for part in gloss_parts.keys() %}
        {% set part_index = loop.index %}
        <p class='radio'>
          <div class="radio">
          <b>{{part}}:</b>
          <input type="radio" id="{{part}}_{{val}}" name="{{part}}" value=None}>
          <label for="{{part}}_{{val}}">None</label>
          {% for val in gloss_parts.get(part) %} {{value}}
          <input type="radio" id="{{part}}_{{val}}" name="{{part}}" value={{val}} onclick="change_generate_option(this)">
          <label for="{{part}}_{{val}}">{{val}}</label>
          {% endfor %}
          </div>
        </p>
        {% endfor %}
        <label for="gen_params">Generate parameters:</label>
        <textarea id='gen_params'></textarea>
        <br />
      </div>
<br />

    <form action="/get_morph_results" method="post">
    <label for="gen_text">Generate:</label>
    <input type="text" id="gen_text" name="gen_text" size="80">

    <input type="button" id='btb-generated' onclick="get_generate_data();">Get generate</button>
    </form>
    {% if use_textarea %} 
    <label for="generate_response">Generate response</label>
    <br />
    <textarea id="generate_response" cols="0"/>
    </textarea>
    {% endif %}

    <h2>Parser</h2>
    <form action="/get_morph_results" method="
    <label for="parse_text">Parse:</label>
    <input type="text" id="parse_text" name="parse_text" size="80">
    <input type="button" id='btb-parse' onclick="get_parse_data();">Get parse</button>
    </form>
    {% if use_textarea %}
    <label for="parse_response">Parse response</label>
    <br />
    <textarea id="parse_response" cols="80"/>
    </textarea>
    {% endif %}

    <h2>Info</h2>
    <p>Grammar rules: {{rules}}
      
    <h2>Samples for testing</h2>

   <!-- samples to populate quickly for testing -->
   <select id='samples' name='samples' onchange="populate_from_sample(this)">
   {% for sample in samples %}
     <option value="{{sample}}">#{{loop.index}}: {{sample}}</option>
   {% endfor %}
   </select>

  </body>
  </html>

